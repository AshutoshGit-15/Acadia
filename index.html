<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸŽ“ Collegiate Inbox Navigator</title>
  <meta name="description" content="Your AI academic inbox companion - All your academic emails, assignments &amp; deadlines in one smart dashboard">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f393.svg" />
  <style>
    :root {
      --primary: #4F46E5;
      --accent: #22C55E;
      --bg: #F7FAFC;
      --alert: #EF4444;
      --text: #1F2937;
      --navbar-bg: #fff;
      --card-bg: #fff;
      --nav-radius: 12px;
      --sidebar-width: 260px;
      --shadow: 0 4px 24px rgba(0,0,0,0.08);
      --transition: 0.3s var(--ease-standard);
      --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
      --success: #22C55E;
      --gray-light: #E5E7EB;
      --avatar-size: 44px;
      --gap: 28px;
      --sidebar-item-h: 44px;
      --yellow: #F59E0B;
      --purple: #8B5CF6;
      --sidebar-collapsed-width: 72px;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --primary: #818CF8;
        --accent: #4ADE80;
        --bg: #181A1B;
        --navbar-bg: #23272A;
        --card-bg: #23272A;
        --text: #F7FAFC;
        --gray-light: #374151;
        --alert: #F87171;
        --shadow: 0 4px 24px rgba(0,0,0,0.25);
      }
    }
    html, body {
      margin: 0; padding: 0;
      min-height: 100vh;
      font-family: "Inter", "Segoe UI", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background-color 0.35s;
    }
    body.dark {
      background: #181A1B;
      color: #F7FAFC;
    }
    /* Animations */
    .fade-in {
      animation: fadeIn 0.7s var(--ease-standard);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: none; }
    }
    .slide-in-left {
      animation: slideInLeft 0.4s var(--ease-standard);
    }
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-80px); }
      to   { opacity: 1; transform: none; }
    }
    .slide-in-right {
      animation: slideInRight 0.4s var(--ease-standard);
    }
    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(80px); }
      to   { opacity: 1; transform: none; }
    }

    /* Landing/Login Styles */
    .login-bg {
      background: radial-gradient(ellipse at 80% 10%, #4F46E511 0%, #22C55E22 100%),
                  url('https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f393.svg') no-repeat top left/200px,
                  url('https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4c4.svg') no-repeat top right/150px;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .login-container {
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 2.6rem 2rem;
      max-width: 450px;
      width: 100%;
      margin: auto;
      text-align: center;
    }
    .login-container h1 {
      margin-bottom: 0.6rem;
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: -0.02em;
    }
    .login-container p {
      font-size: 1.1rem;
      margin-bottom: 2rem;
      color: #475569;
      background: none;
    }
    .google-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.7em;
      font-size: 1rem;
      font-weight: 500;
      background: var(--primary);
      color: #fff;
      border-radius: 100px;
      border: none;
      box-shadow: 0 2px 8px rgba(79,70,229,0.11);
      padding: 0.7em 2.3em;
      cursor: pointer;
      transition: background 0.22s var(--ease-standard), box-shadow 0.22s var(--ease-standard);
      margin-bottom: 2.4rem;
    }
    .google-btn:hover {
      background: #6366F1;
      box-shadow: 0 4px 16px rgba(79,70,229,0.15);
    }
    .features {
      margin-top: 1.2rem;
      gap: 1.6rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .feature {
      background: var(--gray-light);
      border-radius: 16px;
      padding: 0.95em 1.5em;
      font-size: 1.04em;
      color: var(--primary);
      margin: 0.4rem;
      display: flex;
      align-items: center;
      gap: 0.6em;
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(96, 165, 250, 0.06);
      animation: fadeIn 1.15s cubic-bezier(.13,.76,.64,1) both;
    }
    .feature i {
      font-style: normal;
      font-size: 1.3em;
    }
    @media (max-width: 650px) {
      .login-container {
        padding: 1.6rem 0.6rem;
        max-width: 330px;
      }
    }
    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 36px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--card-bg);
      color: var(--primary);
      border-radius: 14px;
      box-shadow: var(--shadow);
      padding: 0.9em 2em;
      z-index: 9999;
      font-weight: 600;
      display: none;
      opacity: 0;
      animation: fadeIn 0.4s var(--ease-standard);
    }
    .toast.show {
      display: block;
      opacity: 1;
      transition: opacity 0.35s;
    }
    /* Dashboard Styles */
    .dashboard-root {
      min-height: 100vh;
      background: var(--bg);
      transition: background .4s;
    }
    .hide {
      display: none !important;
    }
  </style>
  <!-- FontAwesome for icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
</head>
<body>
<div class="login-bg fade-in" id="loginBg">
  <section class="login-container fade-in" id="landingSection">
      <h1>ðŸŽ“ Collegiate Inbox Navigator</h1>
      <p>Your AI academic inbox companion - All your academic emails, assignments &amp; deadlines in one smart dashboard</p>
      <button class="google-btn" id="googleSignInBtn">
        <i class="fab fa-google"></i> Sign in with Google
      </button>
      <div class="features">
        <span class="feature"><i>ðŸ“§</i> Email Intelligence</span>
        <span class="feature"><i>ðŸ“…</i> Smart Deadlines</span>
        <span class="feature"><i>ðŸ“„</i> Document Hub</span>
        <span class="feature"><i>ðŸ””</i> Priority Alerts</span>
      </div>
  </section>
</div>

<!-- Toast Notification -->
<div id="toast" class="toast"></div>

<!-- Main Dashboard Page (hidden initially) -->
<div id="dashboardRoot" class="dashboard-root hide"></div>

<script>
// -------------------- Mock Data Setup --------------------
const courses = [
  {name: "Data Structures & Algorithms", code: "CS201", color: "#4F46E5", instructor: "Prof. Sharma"},
  {name: "Database Management Systems", code: "CS301", color: "#22C55E", instructor: "Dr. Patel"},
  {name: "Operating Systems", code: "CS302", color: "#F59E0B", instructor: "Prof. Kumar"},
  {name: "Computer Networks", code: "CS303", color: "#EF4444", instructor: "Dr. Singh"},
  {name: "Software Engineering", code: "CS304", color: "#8B5CF6", instructor: "Prof. Mehta"}
];

const deadlines = [
  {course: "Data Structures & Algorithms", course_code: "CS201", title: "Assignment 3: Binary Search Trees", due_date: "2025-11-09T23:59:00", priority: "high", description: "Implement BST operations including insertion, deletion, and traversal methods", type: "assignment"},
  {course: "Database Management Systems", course_code: "CS301", title: "Project Milestone 2: Schema Design", due_date: "2025-11-10T17:00:00", priority: "high", description: "Submit normalized database schema with ER diagram", type: "project"},
  {course: "Operating Systems", course_code: "CS302", title: "Lab Report: Process Scheduling", due_date: "2025-11-08T10:00:00", priority: "urgent", description: "Analysis of Round Robin vs FCFS scheduling algorithms", type: "lab"},
  {course: "Computer Networks", course_code: "CS303", title: "Mid-term Examination", due_date: "2025-11-12T14:00:00", priority: "medium", description: "Chapters 1-5: Network layers, protocols, and addressing", type: "exam"},
  {course: "Software Engineering", course_code: "CS304", title: "Group Presentation: Agile Methodologies", due_date: "2025-11-11T15:30:00", priority: "medium", description: "20-minute presentation on Scrum framework implementation", type: "presentation"},
  {course: "Data Structures & Algorithms", course_code: "CS201", title: "Quiz 4: Graph Algorithms", due_date: "2025-11-13T09:00:00", priority: "low", description: "Online quiz covering DFS, BFS, Dijkstra's algorithm", type: "quiz"}
];

const alerts = [
  {type: "urgent", title: "ROOM CHANGE: Operating Systems Lab", message: "Tomorrow's OS lab has been moved from Lab 3 to Lab 5 (Building B)", timestamp: "2025-11-07T14:30:00", course: "CS302", keyword: "ROOM CHANGE"},
  {type: "urgent", title: "CANCELLED: Software Engineering Lecture", message: "Friday's SE lecture is cancelled. Online material will be shared on Classroom.", timestamp: "2025-11-07T11:20:00", course: "CS304", keyword: "CANCELLED"},
  {type: "important", title: "Deadline Extension: DBMS Project", message: "Project Milestone 2 deadline extended by 2 days to Nov 12th due to server issues", timestamp: "2025-11-07T09:15:00", course: "CS301", keyword: "DEADLINE EXTENSION"},
  {type: "info", title: "Guest Lecture: Industry Expert Session", message: "Special session on Cloud Computing by AWS Solutions Architect - Nov 14, 3 PM, Auditorium", timestamp: "2025-11-06T16:45:00", course: "General", keyword: "GUEST LECTURE"},
  {type: "urgent", title: "RESCHEDULED: CN Mid-term Exam", message: "Computer Networks exam moved from Nov 10 to Nov 12 to avoid clash with other exams", timestamp: "2025-11-06T13:00:00", course: "CS303", keyword: "RESCHEDULED"}
];

const documents = [
  {course: "Data Structures & Algorithms", course_code: "CS201", items:[
    {name:"Lecture_Notes_Week8_Trees.pdf",type:"pdf",date:"2025-11-05",size:"2.4 MB"},
    {name:"Assignment3_Instructions.pdf",type:"pdf",date:"2025-11-04",size:"856 KB"},
    {name:"Sample_BST_Code.cpp",type:"code",date:"2025-11-03",size:"12 KB"},
  ]},
  {course:"Database Management Systems", course_code:"CS301", items:[
    {name:"Normalization_Tutorial.pptx",type:"pptx",date:"2025-11-06",size:"3.1 MB"},
    {name:"Project_Rubric.pdf",type:"pdf",date:"2025-11-01",size:"445 KB"},
    {name:"Sample_ER_Diagram.png",type:"image",date:"2025-10-30",size:"678 KB"},
  ]},
  {course:"Operating Systems", course_code:"CS302", items:[
    {name:"Process_Scheduling_Slides.pdf",type:"pdf",date:"2025-11-02",size:"1.8 MB"},
    {name:"Lab6_Instructions.docx",type:"docx",date:"2025-11-07",size:"234 KB"},
  ]},
  {course:"Computer Networks", course_code:"CS303", items:[
    {name:"Chapter4_Transport_Layer.pdf",type:"pdf",date:"2025-11-04",size:"4.2 MB"},
    {name:"Midterm_Topics_List.pdf",type:"pdf",date:"2025-11-06",size:"156 KB"},
  ]},
  {course:"Software Engineering", course_code:"CS304", items:[
    {name:"Agile_vs_Waterfall.pptx",type:"pptx",date:"2025-11-05",size:"2.7 MB"},
    {name:"Presentation_Guidelines.pdf",type:"pdf",date:"2025-10-28",size:"512 KB"},
  ]}
];

const user_profile = {
  name: "Rahul Verma",
  email: "rahul.verma@college.edu.in",
  avatar_initials: "RV",
  student_id: "2023CSE042",
  semester: "5th Semester",
  department: "Computer Science & Engineering"
};

const NOW_TIMESTAMP = new Date("2025-11-07T15:00:00+05:30");
let darkMode = false;
let activeCourseFilter = "All";
let searchQuery = "";
let dashboardLoaded = false;

// -------------- Page Transition: Landing â†’ Dashboard --------------
document.getElementById("googleSignInBtn").addEventListener("click", ()=> {
  document.getElementById("loginBg").classList.add("hide");
  document.getElementById("dashboardRoot").classList.remove("hide");
  if (!dashboardLoaded) renderDashboard();
  dashboardLoaded = true;
});

// ------ Utility Functions ------
function formatDate(dateStr) {
  var date = new Date(dateStr);
  return date.toLocaleString('en-GB', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute:'2-digit' });
}
function getCourseColor(code) {
  let found = courses.find(c=>c.code===code);
  return found ? found.color : "#556";
}
function timeDiffFuture(timeStr) {
  let due = new Date(timeStr);
  let ms = due - NOW_TIMESTAMP;
  if (ms<0) return "Expired";
  let days = Math.floor(ms/(1000*60*60*24));
  let hrs = Math.floor((ms%(1000*60*60*24))/(1000*60*60));
  let mins = Math.floor((ms%(1000*60*60))/(1000*60));
  if (days>0) return `${days}d ${hrs}h`;
  if (hrs>0) return `${hrs}h ${mins}m`;
  return `${mins}min`;
}
function getPriorityColor(priority, dueDate) {
  // Colors: <24h - red, <3d - orange, else green
  let due = new Date(dueDate);
  let ms = due - NOW_TIMESTAMP;
  if (ms < 24*3600000) return 'var(--alert)';
  if (ms < 3*24*3600000) return 'var(--yellow)';
  return 'var(--accent)';
}
function matchSearch(str) {
  if (!searchQuery) return true;
  return str.toLowerCase().includes(searchQuery.toLowerCase());
}

// ---------------- Toast Notification ------------------
function showToast(message) {
  const toast = document.getElementById("toast");
  toast.innerText = message;
  toast.classList.add("show");
  setTimeout(()=>{ toast.classList.remove("show"); }, 2050);
}

// --------------- Dashboard Render --------------------
function renderDashboard() {
  // Main dashboard layout
  const root = document.getElementById("dashboardRoot");
  root.innerHTML = `
    <nav class="dashboard-navbar slide-in-left">
      <div class="nav-left">
        <span class="navbar-title"><span style="font-size:1.12em;margin-right:6px;">ðŸŽ“</span>Collegiate Inbox Navigator</span>
      </div>
      <div class="nav-center">
        <input id="searchBar" type="text" placeholder="Search emails, keywords, or course" />
        <span id="clearSearchBtn" class="hide" style="position:absolute;right:24px;top:10px;cursor:pointer;font-size:1.18em;color:var(--gray-light);"><i class="fas fa-times-circle"></i></span>
      </div>
      <div class="nav-right">
        <span id="themeBtn" class="toggle-btn"><i class="fas fa-moon"></i></span>
        <span id="refreshBtn" class="toggle-btn"><i class="fas fa-sync-alt"></i></span>
        <span class="user-profile-avatar"><span>${user_profile.avatar_initials}</span></span>
        <span class="user-profile-name">${user_profile.name.split(' ')[0]}</span>
      </div>
    </nav>
    <main class="dashboard-main slide-in-right">
      <aside class="dashboard-sidebar" id="sidebar">
        <div class="sidebar-profile">
          <div class="avatar-circle">${user_profile.avatar_initials}</div>
          <div class="sidebar-user-info">
            <strong>${user_profile.name}</strong>
            <small>${user_profile.email}</small>
            <small>${user_profile.semester}, ${user_profile.department}</small>
          </div>
        </div>
        <div class="sidebar-section sidebar-filters">
          <span class="sidebar-filter-btn${activeCourseFilter==='All'?" active":''}" data-course="All">All</span>
          <span class="sidebar-filter-btn${activeCourseFilter==='Today'?" active":''}" data-course="Today">Today</span>
          <span class="sidebar-filter-btn${activeCourseFilter==='This Week'?" active":''}" data-course="This Week">This Week</span>
        </div>
        <div class="sidebar-section sidebar-courses">
          ${courses.map(c=>`<span class="sidebar-course-btn${activeCourseFilter===c.name?" active":''}" data-course="${c.name}" style="border-left:6px solid ${c.color};">${c.name}</span>`).join('')}
        </div>
        <div class="sidebar-section sidebar-actions">
          <span class="sidebar-action-btn"><i class="fas fa-cog"></i> Settings</span>
          <span class="sidebar-action-btn" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</span>
        </div>
      </aside>
      <section class="dashboard-content">
        <div class="content-section deadlines-section" id="deadlinesSection">
          <h2><i class="fas fa-calendar-alt"></i> Upcoming Deadlines</h2>
          <div class="deadlines-grid">
            ${deadlines.filter(item=>deadlineFilter(item)).filter(item=>matchSearch(item.title+item.course+item.description)).map((d,i)=>deadlineCardRender(d,i)).join('')}
          </div>
        </div>
        <div class="content-section alerts-section" id="alertsSection">
          <h2><i class="fas fa-exclamation-triangle" style="color:var(--alert);"></i> Alerts &amp; Notifications</h2>
          <div class="alerts-feed">
            ${alerts.filter(a=>alertFilter(a)).filter(a=>matchSearch(a.title+a.message+a.keyword)).map(alertCardRender).join('')}
          </div>
        </div>
        <div class="content-section documents-section" id="documentsSection">
          <h2><i class="fas fa-file-alt"></i> Key Document Repository</h2>
          <div class="documents-accordion">
            ${documents.filter(doc=>documentFilter(doc)).map(documentAccordionRender).join('')}
          </div>
        </div>
      </section>
    </main>
    <div class="modal-overlay hide" id="summarizeModal"></div>
    <div class="sidebar-backdrop hide" id="sidebarBackdrop"></div>
  `;
  bindDashboardEvents();
  updateCountdownTimers(); // Start timers
}

// ----------------- Dashboard Sub-components Renderers -------------------
function deadlineFilter(item){
  // Filters based on sidebar selection
  if (activeCourseFilter==='All') return true;
  if (activeCourseFilter==='Today') {
    let d = new Date(item.due_date);
    return d.toDateString() === NOW_TIMESTAMP.toDateString();
  }
  if (activeCourseFilter==='This Week') {
    let d = new Date(item.due_date);
    let nowWeek = getWeek(NOW_TIMESTAMP), dWeek = getWeek(d);
    return dWeek === nowWeek && d>=NOW_TIMESTAMP;
  }
  return item.course === activeCourseFilter;
}
function alertFilter(alert){
  if (activeCourseFilter==='All') return true;
  if (activeCourseFilter==='Today' || activeCourseFilter==='This Week') return true;
  let courseMatch = courses.find(c=>c.code===alert.course || c.name===activeCourseFilter);
  return courseMatch && (alert.course===courseMatch.code||alert.course===courseMatch.name);
}
function documentFilter(doc){
  if (activeCourseFilter==='All' || activeCourseFilter==='Today' || activeCourseFilter==='This Week') return true;
  return doc.course === activeCourseFilter;
}
function deadlineCardRender(d,i){
  const priorityColor = getPriorityColor(d.priority,d.due_date);
  return `<div class="deadline-card card fade-in" data-index="${i}" style="border-top:6px solid ${getCourseColor(d.course_code)};">
    <div class="card-head">
      <span class="course-badge" style="background:${getCourseColor(d.course_code)};">${d.course_code}</span>
      <span class="deadline-title">${d.title}</span>
    </div>
    <div class="deadline-date" style="color:${priorityColor}; font-weight:600;">
      <i class="far fa-clock"></i> <span class="countdown-timer" data-date="${d.due_date}">${timeDiffFuture(d.due_date)}</span> <small style="margin-left:6px;">(${formatDate(d.due_date)})</small>
    </div>
    <div class="deadline-desc">${d.description}</div>
    <div class="deadline-actions">
      <button class="cal-btn card-action" data-deadline="${i}"><i class="far fa-calendar-plus"></i> Add to Calendar</button>
      <button class="summary-btn card-action" data-deadline="${i}"><i class="fas fa-info-circle"></i> View Details</button>
    </div>
    <span class="priority-dot" style="background:${priorityColor};"></span>
  </div>`;
}
function alertCardRender(a){
  let icon = {
    urgent: "fas fa-bell", important: "fas fa-bolt", info: "fas fa-info-circle"
  }[a.type]||"fas fa-inbox";
  let color = ({urgent:'var(--alert)', important:'var(--primary)', info:'var(--accent)'})[a.type]||'var(--primary)';
  let urgentWord = ["CANCELLED","RESCHEDULED","ROOM CHANGE","URGENT"].find(k=>a.title.toUpperCase().includes(k));
  return `<div class="alert-card fade-in" style="border-left:5px solid ${color};">
    <div class="alert-main"><span class="alert-icon" style="color:${color};"><i class="${icon}"></i></span><span class="alert-title">${a.title}</span></div>
    <div class="alert-info">${a.message}</div>
    <div class="alert-footer"><small>${formatDate(a.timestamp)}</small>
      <button class="alert-action-btn card-action" style="background:${color};color:#fff;">Acknowledge</button>
    </div>
  </div>`;
}
function documentAccordionRender(doc) {
  return `<div class="accordion-course">
    <div class="accordion-header" data-course="${doc.course}">
      <i class="fas fa-book"></i> <span style="color:${getCourseColor(doc.course_code)}">${doc.course}</span>
    </div>
    <div class="accordion-panel hide">
      <div class="doc-list">
        ${doc.items.filter(item=>matchSearch(item.name)).map(docItemRender).join('')}
      </div>
    </div>
  </div>`;
}
function docItemRender(item) {
  let iconMap={pdf:"fas fa-file-pdf",docx:"fas fa-file-word",pptx:"fas fa-file-powerpoint",code:"fas fa-file-code",image:"fas fa-file-image"};
  let icon = iconMap[item.type]||"fas fa-file-alt";
  return `<div class="doc-item fade-in">
    <span class="doc-icon" style="color:var(--primary);"><i class="${icon}"></i></span>
    <span class="doc-title">${item.name}</span>
    <span class="doc-date">${item.date}</span>
    <span class="doc-size">${item.size}</span>
    <button class="doc-download-btn card-action"><i class="fas fa-download"></i> Download</button>
  </div>`;
}
// ----------- Modal Render ------------
function showSummarizeModal(idx) {
  let d = deadlines[idx];
  let modal = document.getElementById("summarizeModal");
  modal.innerHTML = `<div class="modal-content fade-in">
    <h3><i class="fas fa-envelope" style="color:var(--primary);"></i> Summarize This Email</h3>
    <div class="modal-email-info">
      <strong>${d.title}</strong>
      <div><span class="course-badge" style="background:${getCourseColor(d.course_code)};">${d.course_code}</span>
        <span style="margin-left:7px;color:var(--accent);">Due: ${formatDate(d.due_date)}</span></div>
    </div>
    <div class="modal-email-preview">${d.description}</div>
    <div class="modal-summary"><em>AI Summary:</em> <br> "${getMockAISummary(d.description)}"</div>
    <div class="modal-actions">
      <button onclick="addToCalendar(${idx});">Add to Calendar</button>
      <button onclick="closeModal();">Close</button>
    </div>
  </div>`;
  modal.classList.remove("hide");
}
function closeModal(){
  document.getElementById("summarizeModal").classList.add("hide");
}
function getMockAISummary(text) {
  // Example: Returns a shortened version
  if(!text) return "No content.";
  return text.length>90 ? text.substring(0,88).trim()+"..." : text;
}
// --------- Calendar Animation + Toast ---------
function addToCalendar(idx){
  // Simulate API call
  showToast("âœ“ Added to Google Calendar");
  closeModal();
}
// ----------- Countdown Timers ------------
function updateCountdownTimers() {
  setInterval(()=>{
    document.querySelectorAll('.countdown-timer').forEach(el=>{
      let d = el.getAttribute('data-date');
      el.textContent = timeDiffFuture(d);
    });
  }, 5000);
}
// ----------- Sidebar Interaction ------------
function bindSidebarFilters(){
  document.querySelectorAll('.sidebar-filter-btn').forEach(btn=>{
    btn.onclick = function(){
      activeCourseFilter = btn.getAttribute('data-course');
      renderDashboard();
    };
  });
  document.querySelectorAll('.sidebar-course-btn').forEach(btn=>{
    btn.onclick = function(){
      activeCourseFilter = btn.getAttribute('data-course');
      renderDashboard();
    };
  });
}
// ----------- Document Accordion ------------
function bindAccordionEvents(){
  document.querySelectorAll('.accordion-header').forEach(header=>{
    header.onclick = function(){
      let panel = header.nextElementSibling;
      panel.classList.toggle('hide');
      header.classList.toggle('open');
    };
  });
}
// ----------- Deadline Actions ------------
function bindDeadlineActions(){
  document.querySelectorAll('.cal-btn').forEach(btn=>{
    btn.onclick = function(){
      let idx = btn.getAttribute('data-deadline');
      addToCalendar(idx);
    };
  });
  document.querySelectorAll('.summary-btn').forEach(btn=>{
    btn.onclick = function(){
      let idx = btn.getAttribute('data-deadline');
      showSummarizeModal(idx);
    };
  });
}
// ------------ Alerts Actions --------------
function bindAlertActions(){
  document.querySelectorAll('.alert-action-btn').forEach(btn=>{
    btn.onclick = function(){
      showToast('Alert acknowledged');
      btn.innerHTML = '<i class="fas fa-check"></i> Ack.';
      btn.disabled = true;
    };
  });
}
// ------ Search Bar Functionality ------
function bindSearchBar(){
  let sb = document.getElementById('searchBar');
  let clearBtn = document.getElementById('clearSearchBtn');
  sb.oninput = function(){
    searchQuery = sb.value.trim();
    renderDashboard();
  };
  sb.onfocus = function(){
    if(searchQuery) clearBtn.classList.remove("hide");
  };
  sb.onblur = function(){
    setTimeout(()=>clearBtn.classList.add("hide"),100);
  };
  clearBtn.onclick = function(){
    searchQuery = ""; sb.value = ""; renderDashboard();
    clearBtn.classList.add("hide");
  };
}
// ------ Navbar Buttons ------
function bindNavbarButtons(){
  document.getElementById('themeBtn').onclick = function(){
    darkMode = !darkMode;
    document.body.classList.toggle('dark', darkMode);
    showToast(darkMode ? "Dark Mode Enabled" : "Light Mode Enabled");
  };
  document.getElementById("refreshBtn").onclick = function(){
    showToast("Dashboard refreshed");
    renderDashboard();
  };
}
// --- Logout Functionality ---
function bindLogout(){
  document.getElementById("logoutBtn").onclick = function(){
    document.getElementById("dashboardRoot").classList.add("hide");
    document.getElementById("loginBg").classList.remove("hide");
    dashboardLoaded = false;
    darkMode = false;
    document.body.classList.remove("dark");
    searchQuery = "";
    activeCourseFilter = "All";
  };
}
// ------- Modal Overlay Click -------
function bindModalEvents(){
  document.getElementById("summarizeModal").onclick = function(e){
    if (e.target === this) closeModal();
  };
}
// ------------ Bind All Dashboard Events ------------
function bindDashboardEvents() {
  bindSidebarFilters();
  bindAccordionEvents();
  bindDeadlineActions();
  bindAlertActions();
  bindSearchBar();
  bindNavbarButtons();
  bindLogout();
  bindModalEvents();
}
// --- Utility: get week number in year ---
function getWeek(date) {
  date = new Date(date.valueOf());
  date.setHours(0,0,0,0);
  date.setDate(date.getDate() + 4 - (date.getDay()||7));
  var yearStart = new Date(date.getFullYear(),0,1);
  var weekNo = Math.ceil((((date-yearStart)/86400000)+1)/7);
  return weekNo;
}
</script>
<style>
/* NAVBAR */
.dashboard-navbar {
  background: var(--navbar-bg);
  box-shadow: var(--shadow);
  border-radius: var(--nav-radius);
  padding: 0.7em 2em;
  min-height: 63px;
  display: flex;
  gap: var(--gap);
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 98;
}
.navbar-title {
  font-weight: 700; font-size: 1.26em; letter-spacing: -0.02em;
}
.nav-center { flex: 1; position: relative; }
#searchBar {
  width: 100%; max-width: 330px;
  padding: 11px 14px;
  border-radius: 18px;
  border: 1.6px solid var(--gray-light);
  font-size: 1.11em;
  background: var(--bg);
  color: var(--text);
  outline: none;
  box-sizing: border-box;
  margin: auto;
  font-family: inherit;
  transition: border-color .21s var(--ease-standard);
}
#searchBar:focus { border-color: var(--primary); }
.toggle-btn {
  display: inline-block;
  background: none;
  border: none;
  cursor: pointer;
  font-size: 1.28em;
  margin: 0 0.5em;
}
.user-profile-avatar {
  width: var(--avatar-size);height: var(--avatar-size);
  background: var(--accent);
  color: #fff;
  display: inline-flex;align-items: center;justify-content: center;
  border-radius: 50%;font-weight: 600;font-size: 1.12em;margin-right: 4px;
}
.user-profile-name {
  font-weight: 600;color: var(--primary);font-size: 1.09em;margin-right: 1.1em;
  letter-spacing:-.02em;
}
/* SIDEBAR */
.dashboard-sidebar {
  background: var(--navbar-bg);
  min-width: var(--sidebar-width);
  max-width: var(--sidebar-width);
  padding: 2.2em 1em 1em 1.4em;
  border-radius: 18px;
  box-shadow: var(--shadow);
  display: flex; flex-direction: column;
  gap: 2em; height: calc(100vh - 88px);
  position: sticky; top: 70px; left: 0;
}
.sidebar-profile {
  display:flex;align-items: center;gap:0.7em;
  margin-bottom: 0.7em;
}
.avatar-circle {
  width: 48px;height: 48px;border-radius: 50%;background: var(--primary);color: #fff;
  display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.25em;
}
.sidebar-user-info { font-size: 0.97em; }
.sidebar-section {
  gap: 0.5em; display: flex; flex-direction: column;
}
.sidebar-filter-btn,
.sidebar-course-btn {
  cursor:pointer;
  padding:0.7em 1em; min-height:var(--sidebar-item-h);
  font-weight:500;font-size:0.98em;
  border-radius: 10px;
  background: none;border: none;
  transition: background 0.17s;
  margin-bottom:3px;
  color:var(--text);
  display:block;
}
.sidebar-filter-btn.active,
.sidebar-course-btn.active {
  background: var(--gray-light); font-weight:700;
}
.sidebar-course-btn {
  border-left: 6px solid var(--primary);
}
.sidebar-actions { margin-top:1em;gap:0.25em; }
.sidebar-action-btn {
  display:flex;align-items:center;gap:0.6em;font-size:1em;cursor:pointer;
  padding:0.47em 1em;border-radius:9px;background:none;border:none;
  color:var(--primary);font-weight:500;transition:background .18s;
}
.sidebar-action-btn:hover {background: var(--gray-light);}
/* MAIN DASHBOARD */
.dashboard-main {
  display: flex; flex-direction: row; gap: var(--gap);
  align-items: flex-start; justify-content: stretch;
  padding: 1.2em 2em 2.7em 2em;
}
.dashboard-content {
  flex: 1; display: flex; flex-direction: column; gap: var(--gap);
}
.content-section {
  background: var(--card-bg);
  box-shadow: var(--shadow);
  border-radius: 18px;
  padding: 1.4em 1.2em 1.8em 1.2em;
  margin-bottom: 0.7em;
}
.deadlines-section h2, .alerts-section h2, .documents-section h2 {
  font-size:1.3em;
  margin-bottom:1.1em;color:var(--primary);
}
.deadlines-grid {
  display:grid;grid-template-columns: repeat(3,1fr);gap:var(--gap);
}
.deadline-card {
  background: var(--card-bg);
  border-radius: 16px;
  box-shadow: 0 4px 16px rgba(79,70,229,0.10);
  padding:1.18em 1.1em 1.2em 1.1em;
  position:relative;margin-bottom:6px;
  transition: box-shadow .21s,var(--transition);
  display:flex;flex-direction:column;gap:0.7em;
}
.deadline-card:hover {
  box-shadow: 0 8px 28px rgba(79,70,229,0.13);transform:translateY(-2px);
}
.card-head {
  display:flex;align-items:center;gap:0.7em;margin-bottom:4px;
}
.course-badge {
  background: var(--primary);color:#fff;padding:0.26em 1em;border-radius: 9px;font-weight:600;font-size:0.99em;margin-right:6px;
  letter-spacing:-.01em;
}
.deadline-title { font-weight:600; font-size:1.08em;color:var(--primary); }
.deadline-date {font-size: 0.97em; margin-top:2px;}
.deadline-desc { margin-top:3px; margin-bottom:2px; color:#666; font-size:0.99em;}
.deadline-actions {
  display:flex;gap:0.54em;margin-top:6px;
}
.card-action {
  background: var(--gray-light);
  color: var(--primary);
  border: none;
  border-radius: 9px;
  font-weight: 600;
  font-size:0.94em;
  cursor: pointer;
  padding: 0.45em 1.12em;
  transition: background 0.19s,var(--transition);
  box-shadow: 0 1px 4px #E5E7EB28;
}
.card-action:hover { background: var(--accent); color: #fff; }
.priority-dot {
  position:absolute;top:13px;right:15px;width:11px;height:11px;border-radius:50%;display:inline-block;
}
/* Alerts Section */
.alerts-feed {
  display:flex;flex-direction:column;gap:15px;max-height:310px;overflow-y:auto;padding:2px;
}
.alert-card {
  background: var(--bg);
  border-radius: 15px;
  box-shadow: 0 1.5px 9px rgba(239,68,68,0.09);
  padding:1.1em 1em;
  display:flex;flex-direction:column;gap:0.3em;
  border-left: 5px solid var(--primary);
  transition: box-shadow 0.15s;
}
.alert-icon {font-size:1.18em;margin-right:7px;vertical-align:-2px;}
.alert-title {font-weight:600;font-size:1.05em;}
.alert-info {color:#6B7280;font-size:0.95em;margin-left:3px;}
.alert-footer {margin-top:8px;display:flex;align-items:center;gap:0.5em;}
.alert-action-btn {
  background:var(--primary);color:#fff;border-radius:8px;border:none;padding:0.42em 1em;font-weight:600;
  cursor:pointer;font-size:0.96em;
  box-shadow:0 1px 4px #6366F111;
  transition:background .17s;
}
.alert-action-btn:hover {background:var(--accent);}
/* Documents Accordion */
.documents-accordion {margin-top:13px;}
.accordion-course {margin-bottom:9px;}
.accordion-header {
  background: var(--gray-light); cursor:pointer; font-size:1.05em;color:var(--primary);font-weight:600;padding:0.7em 1em;border-radius:11px;
  margin-bottom:4px;display:flex;align-items:center;gap:0.7em;
}
.accordion-header.open { background: var(--primary); color: #fff; }
.accordion-panel {padding:0.65em 1em 0.5em 1em; border-radius:0 0 11px 11px;background: var(--card-bg);}
.doc-list { display: flex; flex-direction: column; gap: 10px; }
.doc-item {
  display:flex;align-items:center;gap:0.85em;padding:0.72em 1em;font-size:1.01em;background:var(--bg);
  border-radius:9px;box-shadow: 0 1px 6px #E5E7EB28;
}
.doc-icon { font-size:1.22em; }
.doc-title { flex:1;font-weight:500;color:var(--primary); }
.doc-date { margin-left:12px;color:#6B7280;min-width:78px;font-size:0.97em; }
.doc-size { margin-left:11px;color:#888;font-size:0.96em; }
.doc-download-btn {
  background: var(--accent); color: #fff; border:none; border-radius:7px; font-size:0.99em;padding:0.38em 0.92em; font-weight:600; cursor:pointer;
  transition:background .18s;
}
.doc-download-btn:hover {background:var(--primary);}

/* MODAL */
.modal-overlay {
  position:fixed;z-index:100;background:rgba(18,19,23,0.41);top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;
  backdrop-filter: blur(3px);
}
.modal-content {
  background: var(--card-bg); border-radius:20px; box-shadow: var(--shadow); padding:2em 2.2em; max-width:420px; min-width:330px;
  display:flex;flex-direction:column;align-items:stretch;gap:12px; animation: fadeIn .44s;
}
.modal-email-info {
  font-size: 1em; color: var(--primary); font-weight:600; margin-bottom:8px;
}
.modal-email-preview {
  background: var(--gray-light); border-radius:10px; padding:9px 12px; font-size:0.97em; color:#2d3748; margin-bottom:4px;
}
.modal-summary {
  background: var(--accent); color: #fff; border-radius:10px; padding:10px 12px; font-size:0.99em; margin-bottom:4px; font-style:italic;
}
.modal-actions {display:flex;gap:0.77em;margin-top:8px;}
.modal-actions button {
  background:var(--primary);color:#fff;border:none;border-radius:8px;font-size:1em;padding:0.44em 1.1em;font-weight:600;cursor:pointer;transition:background .19s;
}
.modal-actions button:hover {background:var(--accent);}
/* SIDEBAR MOBILE / RESPONSIVE */
@media (max-width:1024px){
  .dashboard-main { gap:19px; padding:1.2em 1em 2.2em 1em; }
  .dashboard-navbar { padding:0.7em 1em; gap:14px; }
  .dashboard-sidebar { min-width: 190px; max-width: 190px; }
  .deadlines-grid { grid-template-columns: repeat(2,1fr); }
}
@media (max-width:768px) {
  .dashboard-main { flex-direction:column; gap:12px; padding:1em 5px 1.6em 5px; }
  .dashboard-sidebar { position:fixed; left:-250px; top:58px; min-width:170px; max-width:170px; height:calc(100vh - 65px); z-index:110;transition:left .32s var(--ease-standard);}
  .dashboard-sidebar.open { left:0; }
  .sidebar-backdrop {display:block;position:fixed;z-index:100;top:0;left:0;width:100vw;height:100vh;background:rgba(30,32,44,0.3);}
  .dashboard-content {margin-left:0;}
  .deadlines-grid { grid-template-columns: 1fr; }
}
@media (max-width:500px) {
  .dashboard-navbar { gap:6px; padding:7px 3px 7px 9px; min-height:48px; }
  .navbar-title { font-size:1em; }
  .dashboard-sidebar { min-width: 124px; max-width: 124px; padding:1em 4px; }
  .avatar-circle { width:36px;height:36px;font-size:1.04em; }
}
/* Misc */
::-webkit-scrollbar {width:7px;background:#f3f3f7;}
::-webkit-scrollbar-thumb {border-radius:6px;background:#E5E7EB;}
:focus { outline: 2px solid var(--accent);outline-offset: 2px; }
</style>
<script>
// --- Mobile Sidebar Hamburger ---
(function(){
  var navbar = document.querySelector('.dashboard-navbar');
  if(!navbar) return;
  var hamburger = document.createElement('span');
  hamburger.className = 'toggle-btn';
  hamburger.innerHTML = '<i class="fas fa-bars"></i>';
  hamburger.style.display = 'none';
  hamburger.id = 'hamburgerMenuBtn';
  navbar.insertBefore(hamburger, navbar.firstChild);
})();
function bindMobileSidebar() {
  var sidebar = document.getElementById('sidebar');
  var backdrop = document.getElementById('sidebarBackdrop');
  var hamburger = document.getElementById('hamburgerMenuBtn');
  if(!sidebar||!backdrop||!hamburger) return;
  hamburger.style.display = 'inline-block';
  hamburger.onclick = function(){
    sidebar.classList.add('open');
    backdrop.classList.remove('hide');
  };
  backdrop.onclick = function(){
    sidebar.classList.remove('open');
    backdrop.classList.add('hide');
  };
}
document.addEventListener('DOMContentLoaded',()=>{
  setTimeout(()=>{
    bindMobileSidebar();
  },300);
});
</script>
</body>
</html>
